# Chatbot

Durante a Sprint 2 do projeto, direcionamos nossos esforços para o desenvolvimento de um protótipo de chat integrado ao robô. Inicialmente implementado em Python, esse chatbot visa ser um ponto de contato entre o usuário e o sistema. Esse passo inicial permite que compreendamos as necessidades e desafios específicos da interação com o robô, proporcionando uma base sólida para a evolução do sistema.

Além disso, planejamos uma transição estratégica para o WhatsApp em um futuro próximo. Essa escolha é motivada pela ampla acessibilidade e popularidade do WhatsApp, sendo um aplicativo já integrado aos dispositivos móveis da maioria dos usuários. Essa transição visa não apenas facilitar a adoção do sistema, mas também garantir que a interação ocorra em um ambiente familiar e confortável para os usuários, minimizando a curva de aprendizado e otimizando a eficácia da interface.

## CLI

O Chatbot em CLI representa a primeira iteração para a Sprint 2 do projeto, proporcionando uma interface de linha de comando para que usuários enviem comandos de movimentação a um robô na cervejaria do futuro de Guarulhos. Essa versão é um passo inicial, pois o objetivo futuro é integrar essa funcionalidade em um chat do WhatsApp, tornando a interação mais acessível e conveniente.

O chatbot utiliza expressões regulares para identificar a intenção do usuário, classificando-as em categorias como cumprimento, despedida e solicitações relacionadas aos diferentes locais da cervejaria. Cada intenção está associada a um destino específico na cervejaria, representado por coordenadas (x, y, z) no espaço tridimensional.

O código incorpora dois dicionários: self.intencoes mapeando expressões regulares para intenções e self.destinos mapeando intenções para as coordenadas correspondentes de destino. O chatbot publica as mensagens de posição no tópico 'chatbot_msgs' utilizando o ROS 2. O loop principal do programa solicita entradas do usuário, identifica a intenção por meio das expressões regulares e executa a ação correspondente, como o direcionamento do robô para um local específico na cervejaria.

Além disso, o código fornece métodos para mover o robô para os destinos associados às intenções, encerrar o chat e imprimir mensagens apropriadas. A inicialização do ROS 2 é realizada no método main(), que cria uma instância do chatbot, inicia a conversa e, posteriormente, encerra o ROS 2. A execução do chatbot pode ser feita diretamente com o comando ros2 run navigator chatbot após a compilação do workspace, embora seja recomendado integrá-lo ao restante do sistema usando um script bash na raiz do workspace. Em conjunto, esse código oferece uma interface interativa para controlar o movimento do robô na cervejaria com base nas intenções expressas pelos usuários por meio de mensagens de texto.

## Whatsapp

Como interface de interação com o usuário, optou-se pelo WhatsApp, devido à sua ampla acessibilidade e popularidade, uma vez que é um aplicativo já instalado nos celulares da maioria dos usuários. No Brasil, 99% da população utiliza o aplicativo. O WhatsApp também facilita a criação de chatbots, que são sistemas automatizados capazes de interagir com o usuário por meio de mensagens de texto, voz, imagens, vídeos, documentos, localização e outros tipos de mídia. Esta integração beneficia os funcionários da Ambev, que não precisam se adaptar a uma nova ferramenta, já que o WhatsApp faz parte do seu cotidiano.

Por meio desta integração, os usuários podem interagir com o chatbot enviando perguntas e recebendo respostas via mensagens de texto. O chatbot é projetado para interpretar as mensagens enviadas, identificar a intenção por trás delas e fornecer a resposta mais adequada.

### Protótipo de Baixa Fidelidade

Para essa sprint 2, o grupo desenvolveu o protótipo de baxa fidelidade das interações e funções que o usuário irá ter com o chatbot. O protótipo foi desenvolvido no Figma, uma ferramenta de design que permite a criação de protótipos de baixa e alta fidelidade. O protótipo pode se acessado por meio do [link de acesso](https://www.figma.com/file/30UeP53WIJoLGIjlzd61if/Pr%C3%B3totipo-de-Baixa-Fidelidade?type=design&node-id=0%3A1&mode=design&t=G1gccUgdLWDn5Nad-1). Lá será possivel encontrar o prototipo de baixa fidelidade do chatbot, e também o prototipo de baixa fidelidade do display e página web de cadastro do chatbot.

<p align="center" display="flex" width="300">

![Alt text](../../static/img/wireframe-chatbot.png)

</p>

### Integração com o WhatsApp

A integração com o WhatsApp é realizada por meio de uma árvore de interação e decisão, desenvolvida na linguagem de programação TypeScript. Esta abordagem permite uma programação mais robusta da aplicação. Todo o processo é construído com o auxílio da biblioteca whatsapp-web.js, que simula um cliente do WhatsApp Web. Isso possibilita a troca de mensagens entre o chatbot e o usuário.

### Árvore de Interação

Atualemente a árvore de interação do chatbot é possuir 4 funcionalidades rodando, sendo eles:

1. Verificação de acesso: O chatbot verifica se o usuário possui acesso ao sistema, caso não possua, o chatbot solicita que o usuário fale com um atendente.
2. Acompanhamento de pedido: O chatbot verifica se o usuário deseja acompanhar o status de um pedido, caso sim, o chatbot solicita o número do pedido e retorna o status do pedido.
3. Cancelamento de pedido: O chatbot verifica se o usuário deseja cancelar um pedido, caso sim, o chatbot solicita o número do pedido e cancela o pedido.
4. Falar com um atendente: O chatbot verifica se o usuário deseja falar com um atendente, caso sim, o chatbot envia o contato de um atendente para o usuário entrar em contato.
5. Alteração no nome do usuário: O chatbot verifica se o usuário deseja alterar o nome cadastrado no sistema, caso sim, o chatbot solicita o novo nome do usuário e altera o nome cadastrado no sistema.

### Features da Sprint 3


### Configuração e Execução do Chatbot

Para rodar o ChatBot, siga as instruções abaixo com atenção. Estes passos são essenciais para iniciar a aplicação de forma correta e garantir seu funcionamento adequado.

### Pré-Requisitos

Antes de começar, confirme se você tem a última versão do Node.js instalada. Isso é crucial para a execução do projeto. Você pode verificar a versão instalada com o comando:

```sh
node --version
```

Se necessário, atualize ou instale o Node.js através do [site oficial](https://nodejs.org/).

### Instalação das Dependências

Com o Node.js instalado, navegue até o diretório do projeto `chatbot/src` e instale as dependências do projeto com o gerenciador de pacotes NPM:

```sh
cd src/chatbot/src
npm install
```

Esse comando irá baixar e instalar todas as bibliotecas necessárias definidas no arquivo `package.json`.

### Configuração de Variáveis de Ambiente

As variáveis de ambiente são cruciais para a configuração da aplicação. Crie um arquivo `.env` no diretório `chatbot/src` e insira as chaves e valores apropriados como no exemplo abaixo:

```env
# Chave de API da OpenAI
OPENAI_API_KEY="sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# Modelo GPT a ser utilizado (padrão: gpt-3.5-turbo)
OPENAI_GPT_MODEL="gpt-3.5-turbo"

# Máximo de tokens por solicitação ao GPT
MAX_MODEL_TOKENS=2000

# Habilita a transcrição de mensagens de voz
TRANSCRIPTION_ENABLED=true

# Idioma da transcrição (caso o serviço de transcrição não detecte automaticamente)
TRANSCRIPTION_LANGUAGE="pt-BR"

# Habilita a conversão de texto em fala
TTS_ENABLED=true

# Token de autenticação para o chatbot
AUTH_TOKEN="Chatbot"

# Segredo para o token de autenticação
TOKEN_SECRET="Chatbot"

# URL de conexão com o banco de dados
DATABASE_URL="postgresql://user:password@host:5432/postgres"
```

Substitua os valores de exemplo pelas chaves e informações reais que você possui.

### Iniciando o ChatBot

Com as variáveis de ambiente configuradas, você está pronto para iniciar o chatbot. Execute o seguinte comando:

```sh
npm run start
```

Aguarde o inicialização e fique atento ao terminal para o próximo passo.

### Conectando ao WhatsApp

Após iniciar o chatbot, um QR Code será exibido no terminal. Use o aplicativo WhatsApp no seu celular para escanear esse código:

1. Abra o WhatsApp.
2. Vá até 'Configurações' > 'WhatsApp Web/Desktop'.
3. Escaneie o QR Code mostrado no terminal.

Com esses passos, o chatbot estará ativo e pronto para interagir através do WhatsApp conectado.

Lembre-se de monitorar o terminal para quaisquer mensagens de erro ou logs importantes que possam ajudar a diagnosticar problemas caso o chatbot não funcione como esperado.

## Conclusão

Entendemos que o chatbot desempenhará um papel fundamental no projeto desenvolvido, atuando como interface de interação entre o usuário e o robô. Por meio do chatbot, o usuário poderá solicitar a movimentação de peças, acompanhar o status de pedidos, cancelar pedidos e entrar em contato com um atendente. Adicionalmente, o chatbot será responsável por enviar notificações ao usuário, como, por exemplo, informar quando o robô estiver a caminho do almoxarifado para entregar uma peça.

Este processo de desenvolvimento é extenso, e a equipe tem se dedicado a ele desde a sprint 1, com especial atenção a essa parte do projeto, principalmente após a visita à Cervejaria Ambev em Guarulhos. Essa experiência permitiu uma compreensão mais aprofundada do processo de movimentação de peças e de como o chatbot pode ser útil nesse contexto. Reconhecemos que esta tecnologia é a única em que o almoxarife confia plenamente, e a facilidade de uso pode contribuir significativamente para a eficiência do trabalho dessa persona e dos demais funcionários da Ambev.
